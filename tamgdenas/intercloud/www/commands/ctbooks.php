<?require_once $_SERVER['DOCUMENT_ROOT'].'/modules/command.php';/*** Список ситибуков*/class Ctbooks{	/**	*	Получить список ситибуков<br>	*	author - url автора	*	bounds - прямоугольная гео-область, две пары координат широта/долгота: юг/запад, север/восток (пример - [[55.667662,37.690487],[55.7025,37.769451]] ) 	*/		function get($author, $bounds)	{		global $db;		$params = array();		if($author) $params['author']=normUrl($author);				$cursor = $db->ctbooks->find($params, array('_id'=>true, 'title'=>true));			if(!$bounds) return fixMongoId(iterator_to_array($cursor, false));				$out = array();		$bounds = json_decode($bounds);		foreach($cursor as $iter)		{			if($iter->pois) foreach($iter->pois as $poiId)			{				if($db->poi->findOne(array('_id' => new MongoId($poiId), 'geoPoint'=>array('$within'=>array('$box'=> $bounds))))) $out[] = $iter;			}		}		return fixMongoId($out);	}	/**	*	Удалить все ситибуки	*/		function delete()	{		global $db;		$buf = $db->ctbooks->remove(array(), array('safe'=>true));		return !!$buf['ok'];		}}?>