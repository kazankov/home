<?require_once $_SERVER['DOCUMENT_ROOT'].'/modules/command.php';/*** Ситибук*/class Ctbook{	/**	*	Создать ситибук <br>	*	author   - url создателя, пример -  microsoft.com/users/pupkin , pupkin@microsoft.com	*/	function put($author, $title)	{		if(!$author)error('Автор не указан');		if(!$title)error('Заголовок не указан');		global $db;		$autor = normUrl($author);		$dt = getDateTime(); 				$obj = 	array(			'author'=>$autor,			'createDateTime'=>$dt,			'title'=>$title		);				if(!$db->ctbooks->insert($obj))error('Ошибка записи в базу');		return $obj;	}	/**	*	Редактировать ситибук <br>	*	pois - массив иднетификаторов POI, включенных в ситибук (пример ["519d20099fe5c37c6b00000a", "519d200f9fe5c37c6b00000b"])<br>	*   page - разметка страницы ситибука	*/		function post($id, $title, $pois, $page, $image)	{		if(!$title)error('Заголовок не указан');		global $db;						if($pois)		{			$pois = json_decode($pois);			foreach($pois as $iter)			{				if(!$db->poi->findOne(array('_id' => new MongoId($iter))))error("POI с идентификатором {$iter} не существует");			}		}else{			$pois = null;		}				$obj = 	array(			'title'=>$title,			'pois'=>$pois,			'page'=>$page,			'image'=>$image		);				if(!$db->ctbooks->update(array('_id' => new MongoId($id)), $obj))error('Ошибка записи в базу');		return fixMongoId($obj);		}	/**	*	Получить ситибук 	*/		function get($id)	{		global $db;		return fixMongoId($db->ctbooks->findOne(array('_id' => new MongoId($id))));	}		/**	*	Удалить ситибук 	*/		function delete($id)	{		global $db;		$buf = $db->ctbooks->remove(array('_id' => new MongoId($id)), array("justOne" => true, 'safe'=>true));		return !!$buf['ok'];	}	}?>