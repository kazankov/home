<?require_once $_SERVER['DOCUMENT_ROOT'].'/modules/command.php';/*** Отзыв*/class Review{	/**	*	получить отзыв (идентификатор отзыва получается из команды POI/get )	*/	function get($id)	{		global $db;		return fixMongoId($db->reviews->findOne(array('_id' => new MongoId($id))));	}	/**	*	добавить отзыв	*/	function put($poiId, $author, $text)	{		global $db;		if(!$poiId)error('Идентификатор POI не указан');		if(!$db->poi->findOne(array('_id' => new MongoId($poiId)))) error("POI с идентификатором  $poiId не существует");		if(!$author)error('Автор не указан');		if(!$text)error('Текст отзыва не указан');				$autor = normUrl($author);		$obj = 	array(			'author'=>$autor,			'text'=>$text		);				if(!$db->reviews->insert($obj))error('Ошибка записи в базу');		$buf = fixMongoId($obj);				$db->poi->update(array('_id' => new MongoId($poiId)), array('$set' => array("reviews" => $buf['id'])));				return $buf;	}			/**	*	редактировать отзыв 	*/	function post($id, $text)	{		global $db;		if(!$id)error('Идентификатор  не указан');		if(!$db->reviews->findOne(array('_id' => new MongoId($id)))) error("Отзыв с идентификатором  $id не существует");		if(!$text)error('Текст отзыва не указан');				$obj = 	array(			'text'=>$text		);				if(!$db->reviews->update(array('_id' => new MongoId($id)), $obj)) error('Ошибка записи в базу');		return fixMongoId($obj);	}			/**	*	удалить отзыв 	*/	/*function delete($id)	{		global $db;		$buf = $db->reviews->remove(array('_id' => new MongoId($id)), array("justOne" => true, 'safe'=>true));		$res = !!$buf['ok'];				if($res)		{		//TODO: подумать об удалении отзыва (стоит ли менять структуру базы)		}	}	*/	}?>