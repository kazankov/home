# -*- coding: utf-8 -*-import foursquareimport pymongofrom pymongo import Connection, GEO2Dimport sysmConn = Connection("217.199.220.182")mCol1 = mConn.foursquare.venuesmCol2 = mConn.googleplaces.placesmUnion = mConn.foursquare_googleplaces.poimCol1.ensure_index([("location", GEO2D)])mCol2.ensure_index([("geometry.location", GEO2D)])mCol2.ensure_index({'lc_name' : 1})for iter in mCol2.find({'name': {'$exists': False}}):	iter['lc_name'] = iter['name'].lower().strip()	mCol2.save(iter)doubles = {}	for iter in mCol1.find():	if iter['location'] and iter['name']:		loc = iter['location']		jiter = mCol2.find_one({'geometry.location': {'$near': {'lat': loc['lat'], 'lng': loc['lon']}, '$maxDistance': 0.001}, 'lc_name': iter['name'].lower().strip()})   #около 200 м 		if jiter:			doubles[jiter['_id']] = True					obj = {'name': iter['name'], 'geoPoint': {'lat': loc['lat'], 'lon': loc['lon']}}		mUnion.save(obj)		for iter in mCol2.find():	if iter['geometry.location'] and iter['name']:		loc = iter['geometry']['location']				if iter['_id'] in doubles:			continue			obj = {'name': iter['name'], 'geoPoint': {'lat': loc['lat'], 'lon': loc['lng']}}		mUnion.save(obj)							